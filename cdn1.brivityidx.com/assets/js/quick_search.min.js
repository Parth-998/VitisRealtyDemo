var recommendedSearchesList=[];jQuery((function(){$("#mls_list").length||$("body").append('<input type="hidden" id="mls_list" value="">'),$("#mls_prefix").length||$("body").append('<input type="hidden" id="mls_prefix" value="">'),$("#mls_states").length||$("body").append('<input type="hidden" id="mls_states" value="">'),$("#new_autocomplete").length||$("body").append('<input type="hidden" id="new_autocomplete" value="">');var e=!1,t=[],a="https://cdn1.brivityidx.com/assets/images/autocomplete_icons/",r=a+"map-pin.png",o=a+"search.png",c=a+"recommended.png",i=a+"school.png",s=a+"school-district.png",l=a+"state.png",n=a+"county.png",h=a+"city.png",m=a+"zip.png",u=a+"neighborhood.png",d=a+"mls.png",g=a+"clock.png",p=a+"area.png";function _(e,t,a){var r=new Date;r.setTime(r.getTime()+24*a*60*60*1e3);var o="expires="+r.toUTCString();document.cookie=e+"="+t+";"+o+";"}function v(e){for(var t=e+"=",a=decodeURIComponent(document.cookie).split(";"),r=0;r<a.length;r++){for(var o=a[r];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""}$.widget("custom.catcomplete",$.ui.autocomplete,{_create:function(){this._super(),this.widget().menu("option","items","> :not(.ui-autocomplete-category)")},_renderMenu:function(e,t){var a=this,_="";$.each(t,(function(t,v){var y;if(v.category!=_&&!v.previous_search){var f=r;"Saved Searches"==v.category&&(f=o),"Popular Searches"==v.category&&(f=c),"Elementary School"!=v.category&&"High School"!=v.category&&"Middle School"!=v.category||(f=i),"MLS"==v.category&&(f=d),"School District"==v.category&&(f=s),"State"==v.category&&(f=l),"County"==v.category&&(f=n),"City"==v.category&&(f=h),"Zip"==v.category&&(f=m),"Neighborhood"==v.category&&(f=u),"Area"==v.category&&(f=p);let t="MLS"==v.category?"Listing ID":v.category;e.append("<li class='ui-autocomplete-category'><img class='icon' src='"+f+"'/>&nbsp; "+t+"</li>"),_=v.category}v.previous_search&&e.append("<li class='ui-autocomplete-category'><img class='icon' src='"+g+"'/>&nbsp; MOST RECENT SEARCH</li>"),y=a._renderItemData(e,v),v.category&&y.attr("aria-label",v.category+" : "+v.label)}))}});var y=[],f=[];function b(){(f=function(){var e=v("cached_search_params");if(e&&JSON.parse(e)){var t=JSON.parse(e);t.multi_search&&(t.multi_search=atob(t.multi_search));var a=!1;if(Object.keys(t).forEach((function(e){t[e]&&"0"!=t[e]&&"hash_url"!=e&&("multi_search"==e&&(t[e]=t[e].replace("|",", ")),a=!0)})),a)return S([t],!1)}return!1}()||[]).length||(previous_search=v("multi_search"),previous_search&&(previous_search_cat=v("multi_cat")||"",f.push({category:previous_search_cat,label:previous_search,value:previous_search,previous_search:!0})))}function S(e,t){if(e.length){var a=[];return $.each(e,(function(e){var r=this.search_name||"",o="";parseInt(this.bedrooms)&&(o+=(o?", ":"")+this.bedrooms+"+ beds"),parseInt(this.bathrooms)&&(o+=(o?", ":"")+parseInt(this.bathrooms)+"+ baths"),parseInt(this.max_price)&&parseInt(this.min_price)?o+=(o?", ":"")+w(this.min_price)+"-"+w(this.max_price):parseInt(this.max_price)?o+=(o?", ":"")+" <"+w(this.max_price):parseInt(this.min_price)&&(o+=(o?", ":"")+" >"+w(this.min_price)),r=r+((o||this.multi_search)&&t?": ":"")+this.multi_search+(this.multi_search&&o?" - ":"")+o,a.push({category:t?"Saved Searches":"",label:r,searchObj:this,previous_search:!t})})),a}}function w(e){return"$"+parseInt(e)/1e3+"K"}b(),$.ajax({url:"/pages/get_saved_searches.php",dataType:"json"}).done((function(e){1==e.status&&e.searches&&e.searches.mysearches&&(y=S(e.searches.mysearches,!0))})),getRecommendedSearches();var x={};function C(){var e=$("#multi_search").val(),t="no_cat";if(""!=$("#multi_cat").val())switch($("#multi_cat").val()){case"City":t="CityState";break;case"County":t="CountyState";break;case"Neighborhood":t="NeighborhoodCityState";break;default:t=$("#multi_cat").val()}var a=$("#mls_list").val(),r="?#?q_limit="+($("#perPage").length?$("#perPage").val():9)+"&mlsId="+a+"&multi_search="+e+"&q_sort=createdAt-&q_offset=0&multi_cat="+t;if(e){var o={multi_search:btoa(e),bedrooms:"",bathrooms:"",min_price:"",max_price:"",hash_url:btoa(r)};_("cached_search_params",JSON.stringify(o),7),b()}window.location.href="/search.php"+r}function I(e){var t="",a="";e.forEach((function(e){if(e.category!=a){var c=r;"Saved Searches"==e.category&&(c=o),"Elementary School"!=e.category&&"High School"!=e.category&&"Middle School"!=e.category||(c=i),"MLS"==e.category&&(c=d),"School District"==e.category&&(c=s),"State"==e.category&&(c=l),"County"==e.category&&(c=n),"City"==e.category&&(c=h),"Zip"==e.category&&(c=m),"Neighborhood"==e.category&&(c=u),"Area"==e.category&&(c=p),t+='<div class="category"><img class="icon" src="'+c+'"/>&nbsp; '+e.category+"</div>",a=e.category}t+='<div class="item"><a href="/search#?multi_search='+encodeURI(e.value)+"&multi_cat="+encodeURI(e.category)+'">'+e.label+"</a></div>"})),$("#did-you-mean-modal .modal-content .modal-body").html('<div class="result-container">'+t+"</div>")}function L(){if($("#multi_search").val().trim()&&t.length){var e=$("#multi_search").val().trim().replace(/[\W_]+/g,"").toLowerCase(),a=!1;t.forEach((function(t){var r=t.label.replace(/[\W_]+/g,"").toLowerCase();a||e!=r||(a=!0,$("#multi_search").val(t.value),$("#multi_cat").val(t.category),C())}))}}$("#multi_search").catcomplete({minLength:0,delay:50,source:function(e,t){var a=e.term;a in x?t(x[a]):$.getJSON("pages/autocomplete.php?mlsIds="+$("#mls_list").val(),{term:e.term},(function(e,r,o){a&&(e=function(e){var t=["State","City","County","Neighborhood","School District","Zip","Address","MLS","Middle School","Elementary School","High School","Area"],a=[];if(e&&e.length&&(t.forEach((function(t){var r=e.filter((function(e){return e.category==t}));a=a.concat(r)})),a.length!==e.length)){var r=e.filter((function(e){return-1===$.inArray(e.category,t)}));a=a.concat(r)}return a}(e),x[a]=e),""==a&&(y&&y.length&&(e=e.length?e:[],e=y.concat(e)),f&&f.length&&(e=e.length?f.concat(e):f),recommendedSearchesList&&recommendedSearchesList.length&&(e=e.length?e.concat(recommendedSearchesList):recommendedSearchesList),e=e.length?e:[]),t(e)}))},select:function(e,t){if("Saved Searches"==t.item.category||""==t.item.category&&t.item.searchObj){var a=function(e){var t="/search";return e.hash_url&&(t+=atob(e.hash_url).replace("newsearchhash","").replace(/adv_/g,"")),t}(t.item.searchObj);window.location.assign(a)}else"Popular Searches"==t.item.category?window.location.assign(t.item.url||"/search"):($("#multi_search").val(t.item.value),null!=t.item.category&&$("#multi_cat").val(t.item.category),document.activeElement.blur(),_("multi_search",t.item.value,7),_("multi_cat",t.item.category,7),C())},response:function(a,r){if(r.content){var o=r.content.filter((function(e){return!e.searchObj&&"Saved Searches"!=e.category&&""!=e.category}))||[];t=o,e=!o.length&&$("#multi_search").val().trim()}}}),$("#multi_search").focus((function(){(v("multi_search")||recommendedSearchesList.length)&&$("#multi_search").catcomplete("search")})),$.ajax({url:"pages/mls_list.php",dataType:"json"}).done((function(e){$("#mls_list").val(e.mls_list),$("#mls_prefix").val(e.mls_prefix);for(var t="",a=0;a<e.states.states.length;a++)t+=e.states.states[a]+",";$("#mls_states").val(t.substr(0,t.length-1));var r="no";for(a=0;a<e.states.mls.length;a++)if(1==e.states.mls[a].new_autocomplete){r="yes";break}$("#new_autocomplete").val(r)})),$("#doSearch").click((function(){if($("#multi_search").val().trim())if($("#multi_search").val().trim()&&e){var t=null;Object.keys(x).sort().reverse().forEach((function(e){$("#multi_search").val().trim().startsWith(e)&&!t&&x[e].length&&e.length>=3&&(t=x[e])})),t?(I(t),$("#did-you-mean-modal").modal("show")):($("#not-found-modal #search_value").text($("#multi_search").val().trim()),$("#not-found-modal").modal("show"))}else"no_cat"===$("#multi_cat").val()?L():C();else $("#not-found-modal #search_value").text(""),$("#not-found-modal").modal("show")})),$(".quick-search-form").submit((function(t){if($("#multi_search").val().trim())if($("#multi_search").val().trim()&&e){var a=null;Object.keys(x).sort().reverse().forEach((function(e){$("#multi_search").val().trim().startsWith(e)&&!a&&x[e].length&&e.length>=1&&(a=x[e])})),a?(I(a),$("#did-you-mean-modal").modal("show")):($("#not-found-modal #search_value").text($("#multi_search").val().trim()),$("#not-found-modal").modal("show"))}else"no_cat"===$("#multi_cat").val()?$(".ui-autocomplete.ui-widget:visible").length&&L():$("#doSearch").trigger("click");else $("#not-found-modal #search_value").text(""),$("#not-found-modal").modal("show");t.preventDefault()}))}));